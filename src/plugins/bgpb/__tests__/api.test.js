import { parseXml } from '../../../common/network'
import { createDateIntervals, parseFullTransactionsMail, parseFullTransactionsMailCardLimit } from '../api'

describe('createDateIntervals', () => {
  it('should convert date period', () => {
    expect(
      createDateIntervals(new Date('2018-01-01T20:45+03:00'), new Date('2018-03-05T09:00+03:00'))
    ).toEqual(
      [
        [new Date('2018-01-01T20:45:00+03:00'), new Date('2018-02-01T20:44:59.999+03:00')],
        [new Date('2018-02-01T20:45:00+03:00'), new Date('2018-03-04T20:44:59.999+03:00')],
        [new Date('2018-03-04T20:45:00+03:00'), new Date('2018-03-05T09:00:00.000+03:00')]
      ]
    )
  })
})

describe('transactions parsing', () => {
  const tt = [
    {
      name: 'with overdraft',
      xml: '<?xml version="1.0" encoding="windows-1251" ?>\n<BS_Response>\n  <ServerTime>20190926000000</ServerTime>\n<MailAttachment>\n<Attachment>\n<Body Mimetype="text/html" xml:space="preserve"><![CDATA[<html xmlns="http://www.w3.org/1999/xhtml" lang="ru" xml:lang="ru">\n<head>\n<META content="text/html; charset=windows-1251" http-equiv="Content-Type"/>\n<title>Выписка по счету BY77OLMP30140000000300000000</title>\n<style type="text/css">\n\t\tbody{\n\t\tpadding:1;\n\t\tmargin:0;\n\t\tfont-family:Arial,sans-serif;\n\t\tfont-size: 10pt;\n\t\twidth:195mm;\n\t\t}\n\t\ttable{\n\t\t  font-family:Arial,sans-serif;\n\t\tfont-size: 8pt;\n\t\t}\n\t\t.section_1{\n\t\t  width: 18.77cm;\n\t\t  margin: 0;\n\t\t  padding: 0;\n\t\t  font-family:Arial,sans-serif;\n\t\tfont-size: 10pt;\n\t\tline-height: 10pt;\n\t\t}\n\t\t.section_1 tr{\n\t\t  margin: 0;\n\t\t  padding: 0;\n\t\t}\n\t\t.section_1 td{\n\t\t  margin: 0;\n\t\t  padding: 0;\n\t\t}\n\t\t.section_1 .s1{\n\t\t  text-align: left;\n\t\t  width: 11.35cm;\n\t\t}\n\t\t.section_1 .s2{\n\t\twidth: 7.26cm;\n\t\t  text-align: right;\n\t\t  font-weight: bold;\n\t\t}\n\n\t\t.address {\n\t\t  margin-bottom:2.75cm;\n\t  margin-top:2.75cm;\n\t\t}\n\n\t.section_2{\n\t  width: 19.39cm;\n\t  line-height: 8pt;\n\t\t\tborder-collapse:collapse;\n\t\t\tborder: 1px solid #777;\n\t}\n\t.section_2 th{\n\t  text-align: left;\n\t  border-collapse:collapse;\n\t\t\tborder:1px solid #777;\n\t}\n\t.section_2 .sum{\n\t  width: 3.47cm;\n\t  text-align: right;\n\t}\n\n\t.col1{\n\t  width: 8.52cm;\n\t}\n\t.col2{\n\t  width: 4.26cm;\n\t}\n\t.col3{\n\t  width: 2.5cm;\n\t  text-align: right;\n\t}\n\t.col4{\n\t  width: 3.5cm;\n\t  text-align: right;\n\t}\n\t.col5{\n\t  width: 1.59cm;\n\t  text-align: right;\n\t}\n\n\t.col2_1{\n\t  width: 4.78cm;\n\t}\n\t.col2_2{\n\t  width: 4.54cm;\n\t  text-align: left;\n\t}\n\t.col2_3{\n\t  width: 2cm;\n\t  text-align: right;\n\t}\n\t.col2_4{\n\t  width: 2cm;\n\t  text-align: right;\n\t}\n\t.col2_5{\n\t  width: 2cm;\n\t  text-align: right;\n\t}\n\t.col2_6{\n\t  width: 2cm;\n\t  text-align: right;\n\t}\n\t.col2_7{\n\t  width: 2cm;\n\t  text-align: right;\n\t}\n\t.col2_8{\n\t  width: 1.2cm;\n\t  text-align: right;\n\t}\n\n\t.solid {\n\t  border:1px solid #777;\n\t}\n\t.right{\n\t  text-align: right;\n\t}\n\t\t.section_3 {\n\t\t\twidth:19.39cm;\n\t\t\tborder-collapse:collapse;\n\t\t}\n\t\t.section_3 th{\n\t\t\tborder-collapse:collapse;\n\t\t\tborder:1px solid #777;\n\t\t}\n\t\t.section_3 td{\n\t\t\tborder-collapse:collapse;\n\t\t\tborder:1px solid #777;\n\t\t}\n\n\t\t.col3_1{\n\t  width: 1.93cm;\n\t}\n\t.col3_2{\n\t  width: 1.93cm;\n\t}\n\t.col3_3{\n\t  width: 2.86cm;\n\t}\n\t.col3_4{\n\t  width: 2.22cm;\n\t}\n\t.col3_5{\n\t  width: 1.9cm;\n\t}\n\t.col3_6{\n\t  width: 1.59cm;\n\t}\n\t.col3_7{\n\t  width: 1.88cm;\n\t}\n\t.col3_8{\n\t  width: 5.08cm;\n\t}\n\t.col3_9{\n\t  width: 5.08cm;\n\t}\n  .col3_10{\n\t  width: 5.08cm;\n\t}\n\n\t.section_4 {\n\t  width:19.39cm;\n\t\t\tborder-collapse:collapse;\n\t\t\tborder:1px solid #777;\n\t\t}\n\n\t\t.section_4 th{\n\t  vertical-align: top;\n\t  border-collapse:collapse;\n\t\t\tborder:1px solid #777;\n\t}\n\n\t\t.col4_1{\n\t  width: 3.8cm\n\t}\n\t.col4_2{\n\t  width: 3.8cm;\n\t}\n\t.col4_3{\n\t  width: 3.8cm;\n\t}\n\t.col4_4{\n\t  width: 3.8cm;\n\t}\n\t.col4_5{\n\t  width: 3.8cm;\n\t}\n\n\t.section_5 {\n\t  width:19.39cm;\n\t  border-collapse:collapse;\n\t  border:1px solid #777;\n\t\t\t\t  }\n\t.section_5 th{\n\t  vertical-align: top;\n\t  border-collapse:collapse;\n\t  border:1px solid #777;\n\t}\n\n\t.col5_1{\n\t  width: 4cm;\n\t}\n\t.col5_2{\n\t  width: 4cm;\n\t}\n\t.col5_3{\n\t  width: 4cm;\n\t}\n\t.col5_4{\n\t  width: 4cm;\n\t}\n\t\n\t.section_6 {\n\t  width:19.39cm;\n\t  border-collapse:collapse;\n\t  border:1px solid #777;\n\t\t\t\t  }\n\t.section_6 th{\n\t  vertical-align: top;\n\t  border-collapse:collapse;\n\t  border:1px solid #777;\n\t}\n\n\t.col6_1{\n\t  width: 1.93cm;\n\t}\n\t.col6_2{\n\t  width: 1.93cm;\n\t}\n\t.col6_3{\n\t  width: 2.86cm;\n\t}\n\t.col6_4{\n\t  width: 2.22cm;\n\t}\n\t.col6_5{\n\t  width: 1.9cm;\n\t}\n\t.col6_6{\n\t  width: 1.59cm;\n\t}\n\t.col6_7{\n\t  width: 1.88cm;\n\t}\n\t.col6_8{\n\t  width: 5.08cm;\n\t}\n\t\n\t.section_7 {\n\t  width:19.39cm;\n\t  border-collapse:collapse;\n\t  border:1px solid #777;\n\t\t\t\t  }\n\t.section_7 th{\n\t  vertical-align: top;\n\t  border-collapse:collapse;\n\t  border:1px solid #777;\n\t}\n\n\t.col7_1{\n\t  width: 1.93cm;\n\t}\n\t.col7_2{\n\t  width: 1.93cm;\n\t}\n\t.col7_3{\n\t  width: 2.86cm;\n\t}\n\t.col7_4{\n\t  width: 2.22cm;\n\t}\n\t.col7_5{\n\t  width: 1.9cm;\n\t}\n\t.col7_6{\n\t  width: 1.59cm;\n\t}\n\t.col7_7{\n\t  width: 1.88cm;\n\t}\n\t.col7_8{\n\t  width: 5.08cm;\n\t}\n  </style>\n</head>\n<body>БЕЛГАЗПРОМБАНК ОАО<br/>г. Минск, ул. Притыцкого 60/2<br/>\n<br/>\n\t\tВыполнено 2019.09.26/12:00:00/<br/>\n<br/>\n<p style="margin-right:auto; width:20cm; text-align:center;">\n<b>Выписка по счету BY77OLMP30140000000300000000</b>\n</p>\n<p style="margin-right:auto; width:20cm; text-align:center;">\n<b>За период: с 26.09.2019 по 26.09.2019</b>\n</p>\n<table class="section_1">\n<tr>\n<td class="s1">Вариант продукта:</td>\n<td class="s2">Зарплатная карточка MasterCard Standard</td>\n</tr>\n<tr>\n<td class="s1">Номер контракта:</td>\n<td class="s2">SL/123456</td>\n</tr>\n<tr>\n<td class="s1">Номер карточного счета:</td>\n<td class="s2">BY77OLMP30140000000300000000</td>\n</tr>\n<tr>\n<td class="s1">Валюта карточного счета:</td>\n<td class="s2">BYN</td>\n</tr>\n<tr>\n<td class="s1">Лимит овердрафта:</td>\n<td class="s2">9 000,00</td>\n</tr>\n<tr>\n<td class="s1">Размер неснижаемого остатка:</td>\n<td class="s2">0,00</td>\n</tr>\n<tr>\n<td class="s1">Владелец карточного счета:</td>\n<td class="s2">ПЕТРОВ ИВАН ИВАНОВИЧ</td>\n</tr>\n<tr>\n<td class="s1">Адрес владельца:</td>\n<td class="s2">220000, МИНСКАЯ обл., МИНСКИЙ р-н., г. МИНСК, ул. ОКТЯБРЬСКАЯ, д.1, кв.1</td>\n</tr>\n</table>\n<br/>\n<br/>\n<div style="font-weight: bold;font-size: 8pt;text-align:left;">ИНФОРМАЦИЯ ПО КАРТОЧНОМУ СЧЕТУ ЗА ПЕРИОД</div>\n<br/>\n<table style="border:none;" class="section_2">\n<tr>\n<td>Остаток/задолженность на 26.09.2019</td>\n<td class="sum">-8 754,89 BYN</td>\n</tr>\n<tr>\n<td>Остаток/задолженность на 26.09.2019</td>\n<td class="sum">-8 754,89 BYN</td>\n</tr>\n</table>\n<br/>\n<table class="section_2">\n<tr>\n<th class="col1">1. ОПЕРАЦИИ</th>\n<th class="col2">Период</th>\n<th class="col3">Зачислено</th>\n<th class="col4">Списано</th>\n<th class="col5">Валюта</th>\n</tr>\n<tr>\n<td class="col1">Операции без карт</td>\n<td class="col2">26.09.2019 - 26.09.2019</td>\n<td class="col3">0,00</td>\n<td class="col4">0,00</td>\n<td class="col5">BYN</td>\n</tr>\n<tr>\n<td class="col1">Операции с картами</td>\n<td class="col2">26.09.2019 - 26.09.2019</td>\n<td class="col3">0,00</td>\n<td class="col4">0,00</td>\n<td class="col5">BYN</td>\n</tr>\n<tr style="font-weight: bold;">\n<td class="col1">Итого по операциям</td>\n<td class="col2">26.09.2019 - 26.09.2019</td>\n<td class="col3">0,00</td>\n<td class="col4">0,00</td>\n<td class="col5">BYN</td>\n</tr>\n</table>\n<br/>\n<table class="section_2">\n<tr>\n<th class="col2_1">2. ВОЗНАГРАЖДЕНИЯ БАНКУ</th>\n<th class="col2_2">Период</th>\n<th class="col2_3">Задолженность на начало периода</th>\n<th class="col2_4">Рассчитано</th>\n<th class="col2_5">Уплачено</th>\n<th class="col2_6">Задолженность на конец периода</th>\n<th class="col2_7">В том числе просроченная задолженность</th>\n<th class="col2_8">Валюта</th>\n</tr>\n<tr>\n<td class="col2_1">Проценты за овердрафт</td>\n<td class="col2_2">26.09.2019 - 26.09.2019</td>\n<td class="col2_3">0,00</td>\n<td class="col2_4">0,00</td>\n<td class="col2_5">0,00</td>\n<td class="col2_6">0,00</td>\n<td class="col2_7">0,00</td>\n<td class="col2_8">BYN</td>\n</tr>\n<tr>\n<td class="col2_1">Комиссии за обслуживание счета</td>\n<td class="col2_2">26.09.2019 - 26.09.2019</td>\n<td class="col2_3">0,00</td>\n<td class="col2_4">0,00</td>\n<td class="col2_5">0,00</td>\n<td class="col2_6">0,00</td>\n<td class="col2_7">0,00</td>\n<td class="col2_8">BYN</td>\n</tr>\n<tr>\n<td class="col2_1">Комиссии по операциям</td>\n<td class="col2_2">26.09.2019 - 26.09.2019</td>\n<td class="col2_3">0,00</td>\n<td class="col2_4">0,00</td>\n<td class="col2_5">0,00</td>\n<td class="col2_6">0,00</td>\n<td class="col2_7">0,00</td>\n<td class="col2_8">BYN</td>\n</tr>\n<tr style="font-weight: bold;">\n<td class="col2_1">Итого по вознаграждениям банку</td>\n<td class="col2_2">26.09.2019 - 26.09.2019</td>\n<td class="col2_3">0,00</td>\n<td class="col2_4">0,00</td>\n<td class="col2_5">0,00</td>\n<td class="col2_6">0,00</td>\n<td class="col2_7">0,00</td>\n<td class="col2_8">BYN</td>\n</tr>\n<tr>\n<td class="col2_1"/>\n<td class="col2_3"/>\n<td class="col2_4"/>\n<td class="col2_5"/>\n<td class="col2_6"/>\n<td class="col2_7"/>\n<td class="col2_8"/>\n</tr>\n<tr style="font-weight: bold;">\n<td class="col2_1">Задолженность по вознаграждениям банку на  26.09.2019</td>\n<td style="text-align: right;">x</td>\n<td class="col2_3">x</td>\n<td class="col2_4">x</td>\n<td class="col2_5">x</td>\n<td class="col2_6">x</td>\n<td class="col2_7">0,00</td>\n<td class="col2_8">BYN</td>\n</tr>\n<tr style="font-weight: bold;">\n<td class="col2_1">в том числе просроченная задолженность</td>\n<td style="text-align: right;">x</td>\n<td class="col2_3">x</td>\n<td class="col2_4">x</td>\n<td class="col2_5">x</td>\n<td class="col2_6">x</td>\n<td class="col2_7">0,00</td>\n<td class="col2_8">BYN</td>\n</tr>\n</table>\n<br/>\n<table class="section_2">\n<tr>\n<th class="col1">3. ВОЗНАГРАЖДЕНИЯ КЛИЕНТУ</th>\n<th class="col2">Период</th>\n<th class="col3">Рассчитано</th>\n<th class="col4">Уплачено</th>\n<th class="col5">Валюта</th>\n</tr>\n<tr>\n<td class="col1">Проценты за положительный остаток по карточному счету</td>\n<td class="col2">26.09.2019 - 26.09.2019</td>\n<td class="col3">0,00</td>\n<td class="col4">0,00</td>\n<td class="col5">BYN</td>\n</tr>\n<tr>\n<td class="col1">Процентное вознаграждение по операциям</td>\n<td class="col2">26.09.2019 - 26.09.2019</td>\n<td class="col3">0,00</td>\n<td class="col4">0,00</td>\n<td class="col5">BYN</td>\n</tr>\n<tr style="font-weight: bold;">\n<td class="col1">Итого по вознаграждениям клиенту</td>\n<td class="col2">26.09.2019 - 26.09.2019</td>\n<td class="col3">0,00</td>\n<td class="col4">0,00</td>\n<td class="col5">BYN</td>\n</tr>\n</table>\n<br/>\n<div style="font-weight: bold;font-size: 8pt;text-align:left;">ДЕТАЛЬНАЯ ИНФОРМАЦИЯ ЗА ПЕРИОД</div>\n<table class="section_3">\n<tr>\n<th class="col3_1">Дата операции</th>\n<th class="col3_2">Дата отражения</th>\n<th class="col3_3">Операция</th>\n<th class="col3_4">Тип операции</th>\n<th class="col3_5">Сумма в валюте операции</th>\n<th class="col3_6">Валюта операции</th>\n<th class="col3_7">Сумма в валюте счета</th>\n<th>Валюта счета</th>\n<th class="col3_8">Место операции (страна, наименование точки, город)</th>\n<th class="col3_9">Код авторизации</th>\n<th class="col3_10">МСС</th>\n</tr>\n<tr>\n<td style="border: none;width:17cm;" colspan="8"/>\n</tr>\n</table>\n<br/>\n<div style="font-weight: bold;font-size: 8pt;text-align:left;">ДОЛЯ БЕЗНАЛИЧНЫХ ОПЕРАЦИЙ ПО СЧЕТУ *</div>\n<table class="section_5">\n<tr>\n<th class="col5_1">Анализируемый период времени</th>\n<th class="col5_2">Сумма безналичных операций **, в валюте счета</th>\n<th class="col5_3">Сумма зарплатных зачислений, в валюте счета</th>\n<th class="col5_4">Доля безналичных операций, в процентах</th>\n</tr>\n<tr class="right">\n<td>Июнь 2019 - Август 2019</td>\n<td>736,30</td>\n<td>-</td>\n<td/>\n</tr>\n</table>\n<div style="text-align:left;width:19cm;font-size:7pt;">* рассчитывается за три последних календарных месяца, предшествующих месяцу расчета</div>\n<div style="text-align:left;width:19cm;font-size:7pt;">** в сумму безналичных операций не включаются суммы операций перевода денежных средств с карты на другие карты</div>\n<br/>\n<div style="text-align:left;width:19cm;font-size:8pt;font-weight:bold;">Сумма безналичных операций, в долларах США: 359.65</div>\n<br/>\n<br/>\n<div style="font-weight: bold;font-size: 8pt;text-align:left;">ГРАФИК ПОГАШЕНИЯ ОВЕРДРАФТНОГО КРЕДИТА (ОСНОВНОЙ ДОЛГ)</div>\n<table class="section_4">\n<tr>\n<th class="col4_1">Дата образования долга</th>\n<th class="col4_2">Сумма долга на дату образования (в валюте счета)</th>\n<th class="col4_3">Сумма погашенного долга (в валюте счета)</th>\n<th class="col4_4">Сумма непогашенного долга (в валюте счета)</th>\n<th class="col4_5">Срок погашения</th>\n</tr>\n<tr class="right">\n<td>24.01.2019</td>\n<td>2 098,95</td>\n<td>1 751,44</td>\n<td>347,51</td>\n<td>31.12.2019</td>\n</tr>\n<tr class="right">\n<td>25.01.2019</td>\n<td>4,09</td>\n<td>-</td>\n<td>4,09</td>\n<td>31.12.2019</td>\n</tr>\n<tr class="right">\n<td>01.02.2019</td>\n<td>1 103,46</td>\n<td>-</td>\n<td>1 103,46</td>\n<td>31.12.2019</td>\n</tr>\n<tr class="right">\n<td>11.02.2019</td>\n<td>8,35</td>\n<td>-</td>\n<td>8,35</td>\n<td>31.12.2019</td>\n</tr>\n<tr class="right">\n<td>12.02.2019</td>\n<td>202,66</td>\n<td>-</td>\n<td>202,66</td>\n<td>31.12.2019</td>\n</tr>\n<tr class="right">\n<td>13.02.2019</td>\n<td>2 021,32</td>\n<td>-</td>\n<td>2 021,32</td>\n<td>31.12.2019</td>\n</tr>\n<tr class="right">\n<td>14.02.2019</td>\n<td>86,63</td>\n<td>-</td>\n<td>86,63</td>\n<td>31.12.2019</td>\n</tr>\n<tr class="right">\n<td>15.02.2019</td>\n<td>22,50</td>\n<td>-</td>\n<td>22,50</td>\n<td>31.12.2019</td>\n</tr>\n<tr class="right">\n<td>18.02.2019</td>\n<td>10,74</td>\n<td>-</td>\n<td>10,74</td>\n<td>31.12.2019</td>\n</tr>\n<tr class="right">\n<td>19.02.2019</td>\n<td>71,65</td>\n<td>-</td>\n<td>71,65</td>\n<td>31.12.2019</td>\n</tr>\n<tr class="right">\n<td>20.02.2019</td>\n<td>78,43</td>\n<td>-</td>\n<td>78,43</td>\n<td>31.12.2019</td>\n</tr>\n<tr class="right">\n<td>21.02.2019</td>\n<td>72,96</td>\n<td>-</td>\n<td>72,96</td>\n<td>31.12.2019</td>\n</tr>\n<tr class="right">\n<td>22.02.2019</td>\n<td>3,44</td>\n<td>-</td>\n<td>3,44</td>\n<td>31.12.2019</td>\n</tr>\n<tr class="right">\n<td>25.02.2019</td>\n<td>367,20</td>\n<td>-</td>\n<td>367,20</td>\n<td>31.12.2019</td>\n</tr>\n<tr class="right">\n<td>26.02.2019</td>\n<td>4,43</td>\n<td>-</td>\n<td>4,43</td>\n<td>31.12.2019</td>\n</tr>\n<tr class="right">\n<td>01.03.2019</td>\n<td>2,67</td>\n<td>-</td>\n<td>2,67</td>\n<td>31.12.2019</td>\n</tr>\n<tr class="right">\n<td>18.04.2019</td>\n<td>100,00</td>\n<td>-</td>\n<td>100,00</td>\n<td>31.12.2019</td>\n</tr>\n<tr class="right">\n<td>23.04.2019</td>\n<td>6,68</td>\n<td>-</td>\n<td>6,68</td>\n<td>31.12.2019</td>\n</tr>\n<tr class="right">\n<td>24.04.2019</td>\n<td>380,00</td>\n<td>-</td>\n<td>380,00</td>\n<td>31.12.2019</td>\n</tr>\n<tr class="right">\n<td>26.04.2019</td>\n<td>13,15</td>\n<td>-</td>\n<td>13,15</td>\n<td>31.12.2019</td>\n</tr>\n<tr class="right">\n<td>11.05.2019</td>\n<td>32,48</td>\n<td>-</td>\n<td>32,48</td>\n<td>31.12.2019</td>\n</tr>\n<tr class="right">\n<td>13.05.2019</td>\n<td>26,75</td>\n<td>-</td>\n<td>26,75</td>\n<td>31.12.2019</td>\n</tr>\n<tr class="right">\n<td>21.05.2019</td>\n<td>52,86</td>\n<td>-</td>\n<td>52,86</td>\n<td>31.12.2019</td>\n</tr>\n<tr class="right">\n<td>23.05.2019</td>\n<td>1 050,00</td>\n<td>-</td>\n<td>1 050,00</td>\n<td>31.12.2019</td>\n</tr>\n<tr class="right">\n<td>03.06.2019</td>\n<td>2,63</td>\n<td>-</td>\n<td>2,63</td>\n<td>31.12.2019</td>\n</tr>\n<tr class="right">\n<td>26.06.2019</td>\n<td>51,00</td>\n<td>-</td>\n<td>51,00</td>\n<td>31.12.2019</td>\n</tr>\n<tr class="right">\n<td>27.06.2019</td>\n<td>12,75</td>\n<td>-</td>\n<td>12,75</td>\n<td>31.12.2019</td>\n</tr>\n<tr class="right">\n<td>02.07.2019</td>\n<td>72,23</td>\n<td>-</td>\n<td>72,23</td>\n<td>31.12.2019</td>\n</tr>\n<tr class="right">\n<td>08.07.2019</td>\n<td>78,80</td>\n<td>-</td>\n<td>78,80</td>\n<td>31.12.2019</td>\n</tr>\n<tr class="right">\n<td>09.07.2019</td>\n<td>51,30</td>\n<td>-</td>\n<td>51,30</td>\n<td>31.12.2019</td>\n</tr>\n<tr class="right">\n<td>10.07.2019</td>\n<td>81,00</td>\n<td>-</td>\n<td>81,00</td>\n<td>31.12.2019</td>\n</tr>\n<tr class="right">\n<td>23.07.2019</td>\n<td>8,68</td>\n<td>-</td>\n<td>8,68</td>\n<td>31.12.2019</td>\n</tr>\n<tr class="right">\n<td>25.07.2019</td>\n<td>3,20</td>\n<td>-</td>\n<td>3,20</td>\n<td>31.12.2019</td>\n</tr>\n<tr class="right">\n<td>29.07.2019</td>\n<td>700,00</td>\n<td>-</td>\n<td>700,00</td>\n<td>31.12.2019</td>\n</tr>\n<tr class="right">\n<td>01.08.2019</td>\n<td>102,23</td>\n<td>-</td>\n<td>102,23</td>\n<td>31.12.2019</td>\n</tr>\n<tr class="right">\n<td>13.08.2019</td>\n<td>104,52</td>\n<td>-</td>\n<td>104,52</td>\n<td>31.12.2019</td>\n</tr>\n<tr class="right">\n<td>14.08.2019</td>\n<td>6,25</td>\n<td>-</td>\n<td>6,25</td>\n<td>31.12.2019</td>\n</tr>\n<tr class="right">\n<td>15.08.2019</td>\n<td>38,91</td>\n<td>-</td>\n<td>38,91</td>\n<td>31.12.2019</td>\n</tr>\n<tr class="right">\n<td>16.08.2019</td>\n<td>22,84</td>\n<td>-</td>\n<td>22,84</td>\n<td>31.12.2019</td>\n</tr>\n<tr class="right">\n<td>19.08.2019</td>\n<td>58,88</td>\n<td>-</td>\n<td>58,88</td>\n<td>31.12.2019</td>\n</tr>\n<tr class="right">\n<td>20.08.2019</td>\n<td>5,70</td>\n<td>-</td>\n<td>5,70</td>\n<td>31.12.2019</td>\n</tr>\n<tr class="right">\n<td>22.08.2019</td>\n<td>76,78</td>\n<td>-</td>\n<td>76,78</td>\n<td>31.12.2019</td>\n</tr>\n<tr class="right">\n<td>26.08.2019</td>\n<td>126,75</td>\n<td>-</td>\n<td>126,75</td>\n<td>31.12.2019</td>\n</tr>\n<tr class="right">\n<td>27.08.2019</td>\n<td>58,46</td>\n<td>-</td>\n<td>58,46</td>\n<td>31.12.2019</td>\n</tr>\n<tr class="right">\n<td>02.09.2019</td>\n<td>257,35</td>\n<td>-</td>\n<td>257,35</td>\n<td>31.12.2019</td>\n</tr>\n<tr class="right">\n<td>04.09.2019</td>\n<td>3,20</td>\n<td>-</td>\n<td>3,20</td>\n<td>31.12.2019</td>\n</tr>\n<tr class="right">\n<td>05.09.2019</td>\n<td>3,75</td>\n<td>-</td>\n<td>3,75</td>\n<td>31.12.2019</td>\n</tr>\n<tr class="right">\n<td>06.09.2019</td>\n<td>4,05</td>\n<td>-</td>\n<td>4,05</td>\n<td>31.12.2019</td>\n</tr>\n<tr class="right">\n<td>09.09.2019</td>\n<td>204,31</td>\n<td>-</td>\n<td>204,31</td>\n<td>31.12.2019</td>\n</tr>\n<tr class="right">\n<td>10.09.2019</td>\n<td>57,67</td>\n<td>-</td>\n<td>57,67</td>\n<td>31.12.2019</td>\n</tr>\n<tr class="right">\n<td>11.09.2019</td>\n<td>4,60</td>\n<td>-</td>\n<td>4,60</td>\n<td>31.12.2019</td>\n</tr>\n<tr class="right">\n<td>16.09.2019</td>\n<td>14,84</td>\n<td>-</td>\n<td>14,84</td>\n<td>31.12.2019</td>\n</tr>\n<tr class="right">\n<td>18.09.2019</td>\n<td>39,39</td>\n<td>-</td>\n<td>39,39</td>\n<td>31.12.2019</td>\n</tr>\n<tr class="right">\n<td>19.09.2019</td>\n<td>110,63</td>\n<td>-</td>\n<td>110,63</td>\n<td>31.12.2019</td>\n</tr>\n<tr class="right">\n<td>20.09.2019</td>\n<td>71,91</td>\n<td>-</td>\n<td>71,91</td>\n<td>31.12.2019</td>\n</tr>\n<tr class="right">\n<td>23.09.2019</td>\n<td>210,37</td>\n<td>-</td>\n<td>210,37</td>\n<td>31.12.2019</td>\n</tr>\n<tr class="right">\n<td>24.09.2019</td>\n<td>39,95</td>\n<td>-</td>\n<td>39,95</td>\n<td>31.12.2019</td>\n</tr>\n<tr>\n<td>ВСЕГО задолженность по кредиту:</td>\n<td/>\n<td/>\n<td class="right">8 754,89</td>\n<td/>\n</tr>\n<tr>\n<td>в т.ч.:</td>\n<td/>\n<td/>\n<td class="right"/>\n<td/>\n</tr>\n<tr>\n<td>текущая задолженность</td>\n<td/>\n<td/>\n<td class="right">8 754,89</td>\n<td/>\n</tr>\n<tr>\n<td>просроченная задолженность</td>\n<td/>\n<td/>\n<td class="right">0,00</td>\n<td/>\n</tr>\n</table>\n<div style="text-align:left;width:19cm;font-size:7pt;"/>\n<div style="text-align:left;width:19cm;font-size:9pt;">По любым вопросам, касающимся операций по карточному счету, просим  обращаться по тел.(017) 229-16-21 либо по адресу: 220121 г Минск ул. Притыцкого 60/2 </div>\n<div style="text-align:left;width:19cm;font-size:7pt;"/>\n</body>\n</html>\n]]>\n</Body>\n</Attachment>\n</MailAttachment>\n<Session Expired="895"/>\n</BS_Response>',
      expectedTransactions: [],
      expectedOverdraft: '9 000,00'
    },
    {
      name: 'transactions without overdraft',
      xml: '<?xml version="1.0" encoding="windows-1251" ?>\n<BS_Response>\n<ServerTime>20190926000000</ServerTime>\n<MailAttachment>\n<Attachment>\n<Body Mimetype="text/html" xml:space="preserve"><![CDATA[<html xmlns="http://www.w3.org/1999/xhtml" lang="ru" xml:lang="ru">\n<head>\n<META content="text/html; charset=windows-1251" http-equiv="Content-Type"/>\n<title>Выписка по счету BY77OLMP30140000000300000000</title>\n<style type="text/css">\n\t\tbody{\n\t\tpadding:1;\n\t\tmargin:0;\n\t\tfont-family:Arial,sans-serif;\n\t\tfont-size: 10pt;\n\t\twidth:195mm;\n\t\t}\n\t\ttable{\n\t\t  font-family:Arial,sans-serif;\n\t\tfont-size: 8pt;\n\t\t}\n\t\t.section_1{\n\t\t  width: 18.77cm;\n\t\t  margin: 0;\n\t\t  padding: 0;\n\t\t  font-family:Arial,sans-serif;\n\t\tfont-size: 10pt;\n\t\tline-height: 10pt;\n\t\t}\n\t\t.section_1 tr{\n\t\t  margin: 0;\n\t\t  padding: 0;\n\t\t}\n\t\t.section_1 td{\n\t\t  margin: 0;\n\t\t  padding: 0;\n\t\t}\n\t\t.section_1 .s1{\n\t\t  text-align: left;\n\t\t  width: 11.35cm;\n\t\t}\n\t\t.section_1 .s2{\n\t\twidth: 7.26cm;\n\t\t  text-align: right;\n\t\t  font-weight: bold;\n\t\t}\n\n\t\t.address {\n\t\t  margin-bottom:2.75cm;\n\t  margin-top:2.75cm;\n\t\t}\n\n\t.section_2{\n\t  width: 19.39cm;\n\t  line-height: 8pt;\n\t\t\tborder-collapse:collapse;\n\t\t\tborder: 1px solid #777;\n\t}\n\t.section_2 th{\n\t  text-align: left;\n\t  border-collapse:collapse;\n\t\t\tborder:1px solid #777;\n\t}\n\t.section_2 .sum{\n\t  width: 3.47cm;\n\t  text-align: right;\n\t}\n\n\t.col1{\n\t  width: 8.52cm;\n\t}\n\t.col2{\n\t  width: 4.26cm;\n\t}\n\t.col3{\n\t  width: 2.5cm;\n\t  text-align: right;\n\t}\n\t.col4{\n\t  width: 3.5cm;\n\t  text-align: right;\n\t}\n\t.col5{\n\t  width: 1.59cm;\n\t  text-align: right;\n\t}\n\n\t.col2_1{\n\t  width: 4.78cm;\n\t}\n\t.col2_2{\n\t  width: 4.54cm;\n\t  text-align: left;\n\t}\n\t.col2_3{\n\t  width: 2cm;\n\t  text-align: right;\n\t}\n\t.col2_4{\n\t  width: 2cm;\n\t  text-align: right;\n\t}\n\t.col2_5{\n\t  width: 2cm;\n\t  text-align: right;\n\t}\n\t.col2_6{\n\t  width: 2cm;\n\t  text-align: right;\n\t}\n\t.col2_7{\n\t  width: 2cm;\n\t  text-align: right;\n\t}\n\t.col2_8{\n\t  width: 1.2cm;\n\t  text-align: right;\n\t}\n\n\t.solid {\n\t  border:1px solid #777;\n\t}\n\t.right{\n\t  text-align: right;\n\t}\n\t\t.section_3 {\n\t\t\twidth:19.39cm;\n\t\t\tborder-collapse:collapse;\n\t\t}\n\t\t.section_3 th{\n\t\t\tborder-collapse:collapse;\n\t\t\tborder:1px solid #777;\n\t\t}\n\t\t.section_3 td{\n\t\t\tborder-collapse:collapse;\n\t\t\tborder:1px solid #777;\n\t\t}\n\n\t\t.col3_1{\n\t  width: 1.93cm;\n\t}\n\t.col3_2{\n\t  width: 1.93cm;\n\t}\n\t.col3_3{\n\t  width: 2.86cm;\n\t}\n\t.col3_4{\n\t  width: 2.22cm;\n\t}\n\t.col3_5{\n\t  width: 1.9cm;\n\t}\n\t.col3_6{\n\t  width: 1.59cm;\n\t}\n\t.col3_7{\n\t  width: 1.88cm;\n\t}\n\t.col3_8{\n\t  width: 5.08cm;\n\t}\n\t.col3_9{\n\t  width: 5.08cm;\n\t}\n.col3_10{\n\t  width: 5.08cm;\n\t}\n\n\t.section_4 {\n\t  width:19.39cm;\n\t\t\tborder-collapse:collapse;\n\t\t\tborder:1px solid #777;\n\t\t}\n\n\t\t.section_4 th{\n\t  vertical-align: top;\n\t  border-collapse:collapse;\n\t\t\tborder:1px solid #777;\n\t}\n\n\t\t.col4_1{\n\t  width: 3.8cm\n\t}\n\t.col4_2{\n\t  width: 3.8cm;\n\t}\n\t.col4_3{\n\t  width: 3.8cm;\n\t}\n\t.col4_4{\n\t  width: 3.8cm;\n\t}\n\t.col4_5{\n\t  width: 3.8cm;\n\t}\n\n\t.section_5 {\n\t  width:19.39cm;\n\t  border-collapse:collapse;\n\t  border:1px solid #777;\n\t\t\t\t  }\n\t.section_5 th{\n\t  vertical-align: top;\n\t  border-collapse:collapse;\n\t  border:1px solid #777;\n\t}\n\n\t.col5_1{\n\t  width: 4cm;\n\t}\n\t.col5_2{\n\t  width: 4cm;\n\t}\n\t.col5_3{\n\t  width: 4cm;\n\t}\n\t.col5_4{\n\t  width: 4cm;\n\t}\n\t\n\t.section_6 {\n\t  width:19.39cm;\n\t  border-collapse:collapse;\n\t  border:1px solid #777;\n\t\t\t\t  }\n\t.section_6 th{\n\t  vertical-align: top;\n\t  border-collapse:collapse;\n\t  border:1px solid #777;\n\t}\n\n\t.col6_1{\n\t  width: 1.93cm;\n\t}\n\t.col6_2{\n\t  width: 1.93cm;\n\t}\n\t.col6_3{\n\t  width: 2.86cm;\n\t}\n\t.col6_4{\n\t  width: 2.22cm;\n\t}\n\t.col6_5{\n\t  width: 1.9cm;\n\t}\n\t.col6_6{\n\t  width: 1.59cm;\n\t}\n\t.col6_7{\n\t  width: 1.88cm;\n\t}\n\t.col6_8{\n\t  width: 5.08cm;\n\t}\n\t\n\t.section_7 {\n\t  width:19.39cm;\n\t  border-collapse:collapse;\n\t  border:1px solid #777;\n\t\t\t\t  }\n\t.section_7 th{\n\t  vertical-align: top;\n\t  border-collapse:collapse;\n\t  border:1px solid #777;\n\t}\n\n\t.col7_1{\n\t  width: 1.93cm;\n\t}\n\t.col7_2{\n\t  width: 1.93cm;\n\t}\n\t.col7_3{\n\t  width: 2.86cm;\n\t}\n\t.col7_4{\n\t  width: 2.22cm;\n\t}\n\t.col7_5{\n\t  width: 1.9cm;\n\t}\n\t.col7_6{\n\t  width: 1.59cm;\n\t}\n\t.col7_7{\n\t  width: 1.88cm;\n\t}\n\t.col7_8{\n\t  width: 5.08cm;\n\t}\n</style>\n</head>\n<body>БЕЛГАЗПРОМБАНК ОАО<br/>г. Минск, ул. Притыцкого 60/2<br/>\n<br/>\n\t\tВыполнено 2019.09.28/21:24:26/<br/>\n<br/>\n<p style="margin-right:auto; width:20cm; text-align:center;">\n<b>Выписка по счету BY77OLMP30140000000300000000</b>\n</p>\n<p style="margin-right:auto; width:20cm; text-align:center;">\n<b>За период: с 20.09.2019 по 28.09.2019</b>\n</p>\n<table class="section_1">\n<tr>\n<td class="s1">Вариант продукта:</td>\n<td class="s2">Расчетная карточка "Премиальная" MasterCard World</td>\n</tr>\n<tr>\n<td class="s1">Номер контракта:</td>\n<td class="s2">RS/123456</td>\n</tr>\n<tr>\n<td class="s1">Номер карточного счета:</td>\n<td class="s2">BY77OLMP30140000000300000000</td>\n</tr>\n<tr>\n<td class="s1">Валюта карточного счета:</td>\n<td class="s2">USD</td>\n</tr>\n<tr>\n<td class="s1">Лимит овердрафта:</td>\n<td class="s2">0,00</td>\n</tr>\n<tr>\n<td class="s1">Размер неснижаемого остатка:</td>\n<td class="s2">0,00</td>\n</tr>\n<tr>\n<td class="s1">Владелец карточного счета:</td>\n<td class="s2">Петров Иван Иванович</td>\n</tr>\n<tr>\n<td class="s1">Адрес владельца:</td>\n<td class="s2">МИНСК, ул. Октябрьская, д.1, кв.1</td>\n</tr>\n</table>\n<br/>\n<br/>\n<div style="font-weight: bold;font-size: 8pt;text-align:left;">ИНФОРМАЦИЯ ПО КАРТОЧНОМУ СЧЕТУ ЗА ПЕРИОД</div>\n<br/>\n<table style="border:none;" class="section_2">\n<tr>\n<td>Остаток/задолженность на 20.09.2019</td>\n<td class="sum">1 792,52 USD</td>\n</tr>\n<tr>\n<td>Остаток/задолженность на 28.09.2019</td>\n<td class="sum">1 764,42 USD</td>\n</tr>\n</table>\n<br/>\n<table class="section_2">\n<tr>\n<th class="col1">1. ОПЕРАЦИИ</th>\n<th class="col2">Период</th>\n<th class="col3">Зачислено</th>\n<th class="col4">Списано</th>\n<th class="col5">Валюта</th>\n</tr>\n<tr>\n<td class="col1">Операции без карт</td>\n<td class="col2">20.09.2019 - 28.09.2019</td>\n<td class="col3">0,00</td>\n<td class="col4">0,00</td>\n<td class="col5">USD</td>\n</tr>\n<tr>\n<td class="col1">Операции с картами</td>\n<td class="col2">20.09.2019 - 28.09.2019</td>\n<td class="col3">0,00</td>\n<td class="col4">28,53</td>\n<td class="col5">USD</td>\n</tr>\n<tr style="font-weight: bold;">\n<td class="col1">Итого по операциям</td>\n<td class="col2">20.09.2019 - 28.09.2019</td>\n<td class="col3">0,00</td>\n<td class="col4">28,53</td>\n<td class="col5">USD</td>\n</tr>\n</table>\n<br/>\n<table class="section_2">\n<tr>\n<th class="col2_1">2. ВОЗНАГРАЖДЕНИЯ БАНКУ</th>\n<th class="col2_2">Период</th>\n<th class="col2_3">Задолженность на начало периода</th>\n<th class="col2_4">Рассчитано</th>\n<th class="col2_5">Уплачено</th>\n<th class="col2_6">Задолженность на конец периода</th>\n<th class="col2_7">В том числе просроченная задолженность</th>\n<th class="col2_8">Валюта</th>\n</tr>\n<tr>\n<td class="col2_1">Проценты за овердрафт</td>\n<td class="col2_2">20.09.2019 - 28.09.2019</td>\n<td class="col2_3">0,00</td>\n<td class="col2_4">0,00</td>\n<td class="col2_5">0,00</td>\n<td class="col2_6">0,00</td>\n<td class="col2_7">0,00</td>\n<td class="col2_8">USD</td>\n</tr>\n<tr>\n<td class="col2_1">Комиссии за обслуживание счета</td>\n<td class="col2_2">20.09.2019 - 28.09.2019</td>\n<td class="col2_3">0,00</td>\n<td class="col2_4">0,00</td>\n<td class="col2_5">0,00</td>\n<td class="col2_6">0,00</td>\n<td class="col2_7">0,00</td>\n<td class="col2_8">USD</td>\n</tr>\n<tr>\n<td class="col2_1">Комиссии по операциям</td>\n<td class="col2_2">20.09.2019 - 28.09.2019</td>\n<td class="col2_3">0,00</td>\n<td class="col2_4">0,00</td>\n<td class="col2_5">0,00</td>\n<td class="col2_6">0,00</td>\n<td class="col2_7">0,00</td>\n<td class="col2_8">USD</td>\n</tr>\n<tr style="font-weight: bold;">\n<td class="col2_1">Итого по вознаграждениям банку</td>\n<td class="col2_2">20.09.2019 - 28.09.2019</td>\n<td class="col2_3">0,00</td>\n<td class="col2_4">0,00</td>\n<td class="col2_5">0,00</td>\n<td class="col2_6">0,00</td>\n<td class="col2_7">0,00</td>\n<td class="col2_8">USD</td>\n</tr>\n<tr>\n<td class="col2_1"/>\n<td class="col2_3"/>\n<td class="col2_4"/>\n<td class="col2_5"/>\n<td class="col2_6"/>\n<td class="col2_7"/>\n<td class="col2_8"/>\n</tr>\n<tr style="font-weight: bold;">\n<td class="col2_1">Задолженность по вознаграждениям банку на  28.09.2019</td>\n<td style="text-align: right;">x</td>\n<td class="col2_3">x</td>\n<td class="col2_4">x</td>\n<td class="col2_5">x</td>\n<td class="col2_6">x</td>\n<td class="col2_7">0,00</td>\n<td class="col2_8">USD</td>\n</tr>\n<tr style="font-weight: bold;">\n<td class="col2_1">в том числе просроченная задолженность</td>\n<td style="text-align: right;">x</td>\n<td class="col2_3">x</td>\n<td class="col2_4">x</td>\n<td class="col2_5">x</td>\n<td class="col2_6">x</td>\n<td class="col2_7">0,00</td>\n<td class="col2_8">USD</td>\n</tr>\n</table>\n<br/>\n<table class="section_2">\n<tr>\n<th class="col1">3. ВОЗНАГРАЖДЕНИЯ КЛИЕНТУ</th>\n<th class="col2">Период</th>\n<th class="col3">Рассчитано</th>\n<th class="col4">Уплачено</th>\n<th class="col5">Валюта</th>\n</tr>\n<tr>\n<td class="col1">Проценты за положительный остаток по карточному счету</td>\n<td class="col2">20.09.2019 - 28.09.2019</td>\n<td class="col3">0,00</td>\n<td class="col4">0,00</td>\n<td class="col5">USD</td>\n</tr>\n<tr>\n<td class="col1">Процентное вознаграждение по операциям</td>\n<td class="col2">20.09.2019 - 28.09.2019</td>\n<td class="col3">0,43</td>\n<td class="col4">0,43</td>\n<td class="col5">USD</td>\n</tr>\n<tr style="font-weight: bold;">\n<td class="col1">Итого по вознаграждениям клиенту</td>\n<td class="col2">20.09.2019 - 28.09.2019</td>\n<td class="col3">0,43</td>\n<td class="col4">0,43</td>\n<td class="col5">USD</td>\n</tr>\n</table>\n<br/>\n<div style="font-weight: bold;font-size: 8pt;text-align:left;">ДЕТАЛЬНАЯ ИНФОРМАЦИЯ ЗА ПЕРИОД</div>\n<table class="section_3">\n<tr>\n<th class="col3_1">Дата операции</th>\n<th class="col3_2">Дата отражения</th>\n<th class="col3_3">Операция</th>\n<th class="col3_4">Тип операции</th>\n<th class="col3_5">Сумма в валюте операции</th>\n<th class="col3_6">Валюта операции</th>\n<th class="col3_7">Сумма в валюте счета</th>\n<th>Валюта счета</th>\n<th class="col3_8">Место операции (страна, наименование точки, город)</th>\n<th class="col3_9">Код авторизации</th>\n<th class="col3_10">МСС</th>\n</tr>\n<tr>\n<td style="border: none;width:17cm;" colspan="8">ОПЕРАЦИИ С КАРТАМИ</td>\n</tr>\n<tr>\n<td style="border: none;width:17cm;" colspan="8"/>\n</tr>\n<tr>\n<td class="right">24.09.2019 10:00</td>\n<td class="right">26.09.2019</td>\n<td class="col3_3">Безналичная оплата</td>\n<td>СПИСАНИЕ</td>\n<td class="right">59,00</td>\n<td class="right">BYN</td>\n<td class="right">28,53</td>\n<td class="right">USD</td>\n<td>BY TRATTORIA IGNAZIO, MINSK</td>\n<td>123465</td>\n<td>5812</td>\n</tr>\n<tr>\n<td style="border: none;width:17cm;" colspan="8">Итого по карте N 4321 XXXX XXXX 1234 Иванов Иван Иванович</td>\n</tr>\n<tr>\n<td style="border: none;">зачислено</td>\n<td style="border: none;" class="right">0,00</td>\n<td style="border: none;" class="left">USD</td>\n<td colspan="6" style="border: none;"/>\n</tr>\n<tr>\n<td style="border: none;">списано</td>\n<td style="border: none;" class="right">28,53</td>\n<td style="border: none;" class="left">USD</td>\n<td colspan="6" style="border: none;"/>\n</tr>\n</table>\n<br/>\n<br/>\n<div style="text-align:left;width:19cm;font-size:7pt;"/>\n<div style="text-align:left;width:19cm;font-size:9pt;">По любым вопросам, касающимся операций по карточному счету, просим  обращаться по тел.(017) 229-16-21 либо по адресу: 220121 г Минск ул. Притыцкого 60/2 </div>\n<div style="text-align:left;width:19cm;font-size:7pt;"/>\n</body>\n</html>\n]]>\n</Body>\n</Attachment>\n</MailAttachment>\n<Session Expired="895"/>\n</BS_Response>',
      expectedTransactions: [
        {
          amount: '28,53',
          amountReal: '59,00',
          authCode: '123465',
          cardNum: '1234',
          currency: 'USD',
          currencyReal: 'BYN',
          date: '24.09.2019 10:00',
          description: 'Безналичная оплата',
          mcc: '5812',
          place: 'BY TRATTORIA IGNAZIO, MINSK',
          type: 'СПИСАНИЕ',
          overdraft: '0,00'
        }
      ],
      expectedOverdraft: '0,00'
    }
  ]

  // run all tests
  tt.forEach(function (tc) {
    it(tc.name, () => {
      let res = parseXml(tc.xml)
      let data = res.BS_Response.MailAttachment.Attachment
      let overdraft = parseFullTransactionsMailCardLimit(data)
      expect(overdraft).toEqual(tc.expectedOverdraft)
      expect(parseFullTransactionsMail(data, overdraft)).toEqual(tc.expectedTransactions)
    })
  })
})
