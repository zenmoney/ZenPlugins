## Браузерный отладчик

Браузерный отладчик представляет собой web-сервер, позволяющий запустить в любом современном браузере плагины, и поведение должно быть максимально похожим на поведение на мобильных устройствах.

Для установки зависимостей необходимо в корне репозитория выполнить команду `yarn`.

Советуем сразу открыть консоль разработчика, т.к., к сожалению, пока что мы мало чего рисуем в браузере на UI, и основная коммуникация (вывод ошибок, печать результата) выводится в браузерную консоль.

Содержимое request/response-ов, логгируемое через fetchJson, мы пишем в console.debug(). Помните, что debug стрим логов по умолчанию выключен в консоли браузера.

В Chrome увидеть debug стрим можно включив `Verbose` уровень, как показано ниже:

![console levels](console-levels.png)

### Ввод настроек

Допустим, вы разрабатывате плагин `example`, расположенный в `/src/plugins/example`.

Вам необходимо создать файл `/src/plugins/example/zp_preferences.json` со значениями настроек, описанных вами в `/src/plugins/example/preferences.xml` и содержимым:

```javascript
{
    "login": "example-login",
    "password": "example-password",
    "startDate": "2017-12-01T00:00:00.000Z"
}
```

Окружение проверит наличие заполненных `obligatory` полей в `zp_preferences.json`

### Сохранение данных между вызовами плагина

Данные читаются и сохраняются в `zp_data.json` в папке разрабатываемого плагина.

### Получение текстового ввода

Функция `ZenMoney.retrieveCode` в браузерном отладчике реализована не очень хорошо: она читает значение файла `zp_pipe.txt` в папке плагина до тех пор, пока файл пустой.

После каждого использования этой функции рекомендуется опустошить файл `zp_pipe.txt`, иначе retrieveCode будет возвращать устаревший пользовательский ввод.

Когда-нибудь мы заменим этот костыль на браузерный [confirm](https://developer.mozilla.org/en-US/docs/Web/API/Window/confirm)

### Запуск

Для запуска сервера разработки необходимо указать путь плагина в переменной окружения `PLUGIN` и выполнить команду `yarn start` в корне репозитория.

Допустим, для вышеприведенного примера с плагином в `/src/plugins/example`, необходимо выполнить:

в bash:

```bash
PLUGIN=src/plugins/example yarn start
```

или в windows batch:

```
set "PLUGIN=src/plugins/example" && yarn start
```

При старте начинает работу web-сервер, занимающийся сборкой скриптов и проксированием запросов к сторонним хостам.

После старта в браузере автоматически открывается страница с плагином.

Не забудьте открыть инструменты разработчика!
